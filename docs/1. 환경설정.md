## AI Tutor Phase 4: í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ì„¤ì •

### 1. í”„ë¡œì íŠ¸ ìƒì„±

```bash
mkdir ai-tutor-poc
cd ai-tutor-poc
npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"
```

### 2. shadcn/ui

```bash
npx shadcn@latest init
npx shadcn@latest add button input card avatar badge scroll-area separator sheet skeleton tabs
```

### 3. Supabase Auth + Client

```bash
npm install @supabase/supabase-js @supabase/ssr
```

### 4. KaTeX (ìˆ˜ì‹ ë Œë”ë§)

```bash
npm install katex react-katex
npm install -D @types/katex @types/react-katex
```

### 5. ê¸°íƒ€

```bash
npm install react-markdown lucide-react
```

### 6. í™˜ê²½ ë³€ìˆ˜

```bash
cp .env.example .env.local
```

`.env.local`:
```
NEXT_PUBLIC_SUPABASE_URL=https://muefuihjjihdihzjpvbk.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11ZWZ1aWhqamloZGloempwdmJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5NTA5NzIsImV4cCI6MjA4NjUyNjk3Mn0.K0Y4I3GbEujUIiZWRf8G4ed8htgcyl4__VIeUvrcFNM
NEXT_PUBLIC_N8N_WEBHOOK_URL=https://n8n.srv812064.hstgr.cloud/webhook/6350e749-78cb-4a00-890d-cfa59faafac8
NEXT_PUBLIC_MEM0_API_URL=http://193.168.195.222:8888
```

### 7. ë””ë ‰í† ë¦¬ êµ¬ì¡°

```bash
mkdir -p src/lib
mkdir -p src/components/chat
mkdir -p src/components/landing
mkdir -p src/components/ui
mkdir -p src/app/chat
```

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx              # ëœë”© (/ )
â”‚   â””â”€â”€ chat/
â”‚       â””â”€â”€ page.tsx          # ì±„íŒ… (/chat)
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”œâ”€â”€ chat-panel.tsx    # ì±„íŒ… ì˜ì—­
â”‚   â”‚   â”œâ”€â”€ chat-bubble.tsx   # ë©”ì‹œì§€ ë²„ë¸”
â”‚   â”‚   â”œâ”€â”€ chat-input.tsx    # ì…ë ¥ì°½
â”‚   â”‚   â”œâ”€â”€ katex-renderer.tsx # ìˆ˜ì‹ ë Œë”ë§
â”‚   â”‚   â””â”€â”€ quick-actions.tsx # ì¶”ì²œ ì§ˆë¬¸ ë²„íŠ¼
â”‚   â”œâ”€â”€ landing/
â”‚   â”‚   â”œâ”€â”€ hero.tsx          # íˆì–´ë¡œ ì„¹ì…˜
â”‚   â”‚   â”œâ”€â”€ compare-demo.tsx  # ë¹„êµ ë°ëª¨
â”‚   â”‚   â”œâ”€â”€ architecture.tsx  # ì•„í‚¤í…ì²˜ ì„¤ëª…
â”‚   â”‚   â”œâ”€â”€ student-cards.tsx # ë°ëª¨ ê³„ì • ì¹´ë“œ
â”‚   â”‚   â””â”€â”€ scenarios.tsx     # ì¶”ì²œ ì‹œë‚˜ë¦¬ì˜¤
â”‚   â””â”€â”€ ui/                   # shadcn ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts         # ë¸Œë¼ìš°ì € í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ server.ts         # ì„œë²„ í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ middleware.ts     # auth guard
â”‚   â”œâ”€â”€ api.ts                # n8n webhook, mem0 í˜¸ì¶œ
â”‚   â””â”€â”€ types.ts              # íƒ€ì… ì •ì˜
â””â”€â”€ middleware.ts              # auth redirect
```

### 8. ë¹Œë“œ í™•ì¸

```bash
npm run build
```







# ê°„ë‹¨í•˜ê²Œ ì‘ì—…ë©”ë‰´ì–¼ ì •ë¦¬í•´ë´¤ìŠµë‹ˆë‹¤
# AI Tutor Phase 4 â€” ë°±ì—”ë“œ ì‚¬ì „ì‘ì—… ë§¤ë‰´ì–¼

## 1. Supabase Auth ë°ëª¨ ê³„ì • ìƒì„±

Supabase Dashboard â†’ Authentication â†’ Users â†’ Add User

| ì´ë©”ì¼ | ë¹„ë°€ë²ˆí˜¸ | Auto Confirm |
|--------|----------|-------------|
| kim-sangwi@demo.com | demo1234 | âœ… |
| lee-jungwi@demo.com | demo1234 | âœ… |
| park-hawi@demo.com | demo1234 | âœ… |
| choi-gicho@demo.com | demo1234 | âœ… |

ìƒì„± í›„ ê° ìœ ì €ì˜ **uid** ë³µì‚¬í•´ë‘˜ ê²ƒ.

---

## 2. student_profiles í…Œì´ë¸” ìƒì„± + ë°ì´í„°

Supabase â†’ SQL Editorì—ì„œ ì‹¤í–‰:

```sql
CREATE TABLE student_profiles (
  user_id text PRIMARY KEY,
  display_name text NOT NULL,
  level text NOT NULL,
  score_range text,
  avatar_emoji text DEFAULT 'ğŸ‘¤',
  created_at timestamp DEFAULT now()
);

INSERT INTO student_profiles (user_id, display_name, level, score_range, avatar_emoji) VALUES
('<ê¹€ìƒìœ„-uid>', 'ê¹€ìƒìœ„', 'ìƒìœ„', '90+', 'ğŸ†'),
('<ì´ì¤‘ìœ„-uid>', 'ì´ì¤‘ìœ„', 'ì¤‘ìœ„', '60~80', 'ğŸ“š'),
('<ë°•í•˜ìœ„-uid>', 'ë°•í•˜ìœ„', 'í•˜ìœ„', '40~60', 'âœï¸'),
('<ìµœê¸°ì´ˆ-uid>', 'ìµœê¸°ì´ˆ', 'ê¸°ì´ˆ', '~40', 'ğŸŒ±');
```

> uidëŠ” Supabase Authì—ì„œ ë³µì‚¬í•œ ì‹¤ì œ ê°’ìœ¼ë¡œ êµì²´

---

## 3. n8n_chat_histories í…Œì´ë¸” ìƒì„±

Supabase â†’ SQL Editorì—ì„œ ì‹¤í–‰:

```sql
CREATE TABLE IF NOT EXISTS n8n_chat_histories (
  id serial PRIMARY KEY,
  session_id text NOT NULL,
  message jsonb NOT NULL
);
CREATE INDEX idx_chat_histories_session ON n8n_chat_histories(session_id);
```

---

## 4. Mem0 ì‚¬ì „ ë°ì´í„° ì…ë ¥ (4ëª…)

Windows CMDì—ì„œ ì‹¤í–‰ (ì‹±ê¸€ì¿¼íŠ¸ ë¶ˆê°€ â†’ ë”ë¸”ì¿¼íŠ¸ + ì´ìŠ¤ì¼€ì´í”„):

> âš ï¸ API ê²½ë¡œ: `/memories` (~~`/v1/memories/`~~ ì•„ë‹˜)

**ê¹€ìƒìœ„:**
```cmd
curl -X POST http://193.168.195.222:8888/memories -H "Content-Type: application/json" -d "{\"messages\":[{\"role\":\"user\",\"content\":\"ì´ í•™ìƒì€ ì¸ìˆ˜ë¶„í•´ì™€ ê·¼ì˜ ê³µì‹ ëª¨ë‘ ëŠ¥ìˆ™í•˜ê²Œ ì‚¬ìš©í•œë‹¤. ê³„ì‚° ì†ë„ëŠ” ë¹ ë¥´ì§€ë§Œ ê²€ì‚°ì„ ê±°ì˜ í•˜ì§€ ì•ŠëŠ”ë‹¤. ì‘ìš©ë¬¸ì œì—ì„œ í’€ì´ ì „ëµ ìˆ˜ë¦½ì´ ì•½í•˜ë‹¤. ì‹¬í™” ë¬¸ì œì— ë„ì „í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•˜ê³  ë‹¨ìˆœ ë°˜ë³µ ë¬¸ì œë³´ë‹¤ ìƒˆë¡œìš´ ìœ í˜•ì„ ì„ í˜¸í•œë‹¤.\"}],\"user_id\":\"<ê¹€ìƒìœ„-uid>\"}"
```

**ì´ì¤‘ìœ„:**
```cmd
curl -X POST http://193.168.195.222:8888/memories -H "Content-Type: application/json" -d "{\"messages\":[{\"role\":\"user\",\"content\":\"ì´ í•™ìƒì€ ì¸ìˆ˜ë¶„í•´ë³´ë‹¤ ê·¼ì˜ ê³µì‹ì„ ì„ í˜¸í•œë‹¤. íŒë³„ì‹ì—ì„œ cê°€ ìŒìˆ˜ì¼ ë•Œ ë¶€í˜¸ë¥¼ ìì£¼ í‹€ë¦°ë‹¤. íŠ¹íˆ -4ac ê³„ì‚° ì‹œ ë¶€í˜¸ ë³€í™˜ì„ ì˜ëª»í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ ë°˜ë³µí•œë‹¤. ê·¼ì˜ ê³µì‹ ëŒ€ì… í›„ ìµœì¢… í•´ ê³„ì‚°ì—ì„œ ë¶€í˜¸ ì²˜ë¦¬ ì˜¤ë¥˜ê°€ ìˆë‹¤. ê²€ì‚°ì„ ê±°ì˜ í•˜ì§€ ì•ŠëŠ”ë‹¤.\"}],\"user_id\":\"<ì´ì¤‘ìœ„-uid>\"}"
```

**ë°•í•˜ìœ„:**
```cmd
curl -X POST http://193.168.195.222:8888/memories -H "Content-Type: application/json" -d "{\"messages\":[{\"role\":\"user\",\"content\":\"ì´ í•™ìƒì€ ì´ì°¨ë°©ì •ì‹ê³¼ ì¼ì°¨ë°©ì •ì‹ì˜ ì°¨ì´ë¥¼ í˜¼ë™í•œë‹¤. ë¶€í˜¸ê°€ ìˆëŠ” ê³„ì‚°ì—ì„œ ì‹¤ìˆ˜ê°€ ì¦ë‹¤. ìŒìˆ˜ ê³±í•˜ê¸° ìŒìˆ˜ê°€ ì–‘ìˆ˜ì¸ ê²ƒì„ ìì£¼ í‹€ë¦°ë‹¤. ê³µì‹ì„ ì™¸ìš°ê³  ìˆì§€ë§Œ ì–´ë–¤ ìƒí™©ì— ì ìš©í•˜ëŠ”ì§€ ëª¨ë¥¸ë‹¤. ê°œë… ì„¤ëª…ì„ ë¨¼ì € í•´ì£¼ë©´ ì´í•´ê°€ ë¹¨ë¼ì§„ë‹¤.\"}],\"user_id\":\"<ë°•í•˜ìœ„-uid>\"}"
```

**ìµœê¸°ì´ˆ:**
```cmd
curl -X POST http://193.168.195.222:8888/memories -H "Content-Type: application/json" -d "{\"messages\":[{\"role\":\"user\",\"content\":\"ì´ í•™ìƒì€ ì¤‘í•™êµ ê³¼ì •ì˜ ë¶„ë°°ë²•ì¹™ì´ ë¶ˆì•ˆì •í•˜ë‹¤. ë¶„ìˆ˜ ê³„ì‚°ì´ ì–´ë µê³  í†µë¶„ ì•½ë¶„ì„ ìì£¼ í‹€ë¦°ë‹¤. ì´í•­ ì‹œ ë¶€í˜¸ ë³€í™˜ ê°œë…ì´ ë¶€ì¡±í•˜ë‹¤. xì— ìˆ«ìë¥¼ ëŒ€ì…í•˜ëŠ” ê²ƒì€ ê°€ëŠ¥í•˜ë‹¤. ë§¤ìš° ì²œì²œíˆ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í•´ì•¼ ì´í•´í•œë‹¤.\"}],\"user_id\":\"<ìµœê¸°ì´ˆ-uid>\"}"
```

---

## 5. n8n Postgres Chat Memory ë…¸ë“œ ì¶”ê°€

1. AI Tutor ì›Œí¬í”Œë¡œìš° ì—´ê¸°
2. RAG AI Agent í´ë¦­ â†’ **Memory ìŠ¬ë¡¯**ì— **Postgres Chat Memory** ë…¸ë“œ ì¶”ê°€
3. ì„¤ì •:
   - Credential: AITUTOR Supabase Postgres (Session Pooler)
   - Table Name: `n8n_chat_histories`
   - Session Key: `{{ $('Webhook').item.json.body.user_id }}`

---

## 6. Mem0 Add ë…¸ë“œ JSON Body ìˆ˜ì •

LLM ì¶œë ¥ì´ í¬í•¨ë˜ëŠ” í•„ë“œëŠ” `JSON.stringify()`ë¡œ ê°ì‹¸ì•¼ JSON íŒŒì‹± ì—ëŸ¬ ë°©ì§€:

```json
{
  "messages": [
    {
      "role": "user",
      "content": {{ JSON.stringify($('Memory Summary').item.json.output.summary) }}
    }
  ],
  "user_id": "{{ $('Webhook').item.json.body.user_id }}",
  "agent_id": "lqpagent",
  "run_id": "pocmem0001",
  "infer": false,
  "metadata": {
    "source": "n8n",
    "memory_type": "{{ $('Evaluate').item.json.output.memory_type }}",
    "confidence": {{ $('Evaluate').item.json.output.confidence }},
    "eval_reason": {{ JSON.stringify($('Evaluate').item.json.output.reason) }},
    "origin": "conversation_summary",
    "decision": {{ JSON.stringify($('Memory Summary').item.json.output.decision || '') }},
    "relations": {{ JSON.stringify($('Memory Summary').item.json.output.relations || []) }},
    "timestamp": "{{ $now.toISO() }}"
  }
}
```

> âš ï¸ `content`, `eval_reason`, `decision`ì€ ë°˜ë“œì‹œ `JSON.stringify()` ì‚¬ìš©

---

## 7. Webhook Production ëª¨ë“œ í™œì„±í™”

1. n8n â†’ AI Tutor ì›Œí¬í”Œë¡œìš°
2. ì›Œí¬í”Œë¡œìš° **Activate** (ìš°ì¸¡ ìƒë‹¨ í† ê¸€)
3. Webhook URL í™•ì¸:
   - ~~test:~~ `https://n8n.srv812064.hstgr.cloud/webhook-test/...`
   - **production:** `https://n8n.srv812064.hstgr.cloud/webhook/6350e749-78cb-4a00-890d-cfa59faafac8`

---

## ê²€ì¦ í…ŒìŠ¤íŠ¸

**ê¸°ë³¸ í…ŒìŠ¤íŠ¸ (ì´ì¤‘ìœ„):**
```cmd
curl -X POST https://n8n.srv812064.hstgr.cloud/webhook/6350e749-78cb-4a00-890d-cfa59faafac8 -H "Content-Type: application/json" -d "{\"user_id\":\"<ì´ì¤‘ìœ„-uid>\",\"message\":\"x^2+3x-10=0 í’€ì–´ì¤˜\"}"
```

**ë©€í‹°í„´ í…ŒìŠ¤íŠ¸ (ê°™ì€ uidë¡œ í›„ì† ì§ˆë¬¸):**
```cmd
curl -X POST https://n8n.srv812064.hstgr.cloud/webhook/6350e749-78cb-4a00-890d-cfa59faafac8 -H "Content-Type: application/json" -d "{\"user_id\":\"<ì´ì¤‘ìœ„-uid>\",\"message\":\"ì•„ê¹Œ ê·¸ê±° ì¸ìˆ˜ë¶„í•´ë¡œëŠ” ì–´ë–»ê²Œ í•´?\"}"
```

**í™•ì¸ í¬ì¸íŠ¸:**
- âœ… í•™ìƒ ì•½ì  ë°˜ì˜ëœ ì‘ë‹µ
- âœ… ë¬¸ì œì€í–‰ ì½”ë“œ(QE-001 ë“±) í¬í•¨
- âœ… Mem0 Add ì„±ê³µ (JSON ì—ëŸ¬ ì—†ìŒ)
- âœ… ë©€í‹°í„´: "ì•„ê¹Œ ê·¸ê±°" ì´ì „ ëŒ€í™” ì°¸ì¡°

---

## ì‹¤ì œ uid ë§¤í•‘ (í˜„ì¬ í™˜ê²½)

| í•™ìƒ | uid |
|------|-----|
| ê¹€ìƒìœ„ | 3a0d951f-6fe7-49cf-96e9-d9194fc723fc |
| ì´ì¤‘ìœ„ | f273885e-dcb3-4ae5-8155-292445b9f4ca |
| ë°•í•˜ìœ„ | 066a45cd-9db3-4bd2-bd53-ac89c04cb29b |
| ìµœê¸°ì´ˆ | a1fac652-00f1-461f-b8f5-b740434614ae |